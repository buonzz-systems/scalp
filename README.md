Scalp
=====

Command line tool to Analyze and store your Media file's metadata 

Install
=======

It is very easy to install Scalp as a CLI utility:
<br/>
via wget
```
wget http://downloads.buonzz.com/scalp.phar
sudo mv scalp.phar  /usr/local/bin/scalp
chmod +x /usr/local/bin/scalp
```
via curl

```
curl -o scalp.phar 'http://downloads.buonzz.com/scalp.phar'
sudo mv scalp.phar  /usr/local/bin/scalp
chmod +x /usr/local/bin/scalp
```

After this, scalp command is available anywhere in your computer. To check if the scalp is installed properly, just execute

```
scalp -V
```

This should output

```
Scalp Metadata Extraction Tool by Darwin Biler version v2
```


#### via Composer - Globally

You can install scalp globally in your machine:

```
composer global require 'buonzz/scalp=dev-master'
```

Simply add this directory to your PATH in your ~/.bash_profile (or ~/.bashrc) like this:

```
export PATH=~/.composer/vendor/bin:$PATH
```

#### via Composer - per-project

just require the buonzz/scalp in your composer project

```
{
"require":{
    "buonzz/scalp": "1.*"
  }
}
```

Usage
=====

Scalp can extract the metadata information from your media files and export it to following:

* Static JSON files
* ElasticSearch Server

First, you need to create a configuration file called .env This will be used by scalp to retrieve certain information:

| Setting       | Description                                                                                              | Default        |
|---------------|----------------------------------------------------------------------------------------------------------|----------------|
| DB_HOSTNAME   | database hostname for the ElasticSearch Server                                                           | localhost      |
| DB_NAME       | index name of the documents in ElasticSearch                                                             | metadata       |
| DOC_TYPE      | the document type in ES (table name for RDBMS)                                                           | files          |
| DB_PORT       | port number for ES                                                                                       | 9200           |
| DB_USER       | username for the database                                                                                | null           |
| DB_PASSWORD   | database password                                                                                        | null           |
| INPUT_FOLDER  | the folder on which to read the files to analyze                                                         | current folder |
| OUTPUT_FOLDER | where to dump the JSON files (when using the file:extract command)                                       | dist           |
| LOG_FOLDER    | where to write the log file, this is the log file generated by ElasticSearch client. Useful in debugging | logs           |
| THUMB_PERCENT_RESIZE    | Used when creating thumbnails, this should be between 10-100, the images will be resized with this percent value | 10           |


A file called **.env.example** contains a sample configuration. You can just copy it and rename it to .env and tweak its contents.


#### File Command

To generate static JSON files
```
scalp file:extract
```

#### ES Command

Load it to ElasticSearch
```
scalp es:index
```

#### Thumb Command

create thumbnails
```
scalp thumb:create
```


### Testing Indexed documents

To show all indexes
```
curl 'localhost:9200/_cat/indices?v'
```

To list all documents
```
curl -XGET 'localhost:9200/[your index name]/_search?pretty=true&q=*:*'
```

## Build Environment


In order to build the scalp.phar file, you need to install the box command. To do so:
```
curl -LSs https://box-project.github.io/box2/installer.php | php
```

Make sure you turn off readonly setting of phar file in your php.ini. In PHP7:

```
sudo vi /etc/php/7.0/cli/php.ini
```
Find the *phar.readonly* settings and set it to *Off*


Now move the box.phar file to /usr/local/bin so it can be globally available in console.

```
sudo mv box.phar /usr/local/bin/box
sudo chmod 755 /usr/local/bin/box
```

You are now ready to build phar file!

```
box --version
```

#### Re-compile the phar file

```
./build.sh
```

this will generate a scalp.phar in dist folder. You can run the file by executing

```
php scalp.phar
```

Or to just install it globally:

```
sudo mv dist/scalp.phar  /usr/local/bin/scalp
chmod +x /usr/local/bin/scalp
scalp -V
```
